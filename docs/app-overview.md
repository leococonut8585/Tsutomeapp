# 蜍吶Γ險朱ｭ秘鹸・・sutomeAPP・峨い繝励Μ隧ｳ邏ｰ繝峨く繝･繝｡繝ｳ繝・ 
_譖ｴ譁ｰ譌･: 2025-11-23_

---

## 1. 繝励Ο繝繧ｯ繝域ｦりｦ・- **繧ｳ繝ｳ繧ｻ繝励ヨ**: 繧ｿ繧ｹ繧ｯ邂｡逅・ｒ蜥碁｢ｨ繝輔ぃ繝ｳ繧ｿ繧ｸ繝ｼRPG蛹悶＠縺溘悟漁繝｡險朱ｭ秘鹸縲阪・ 
  - 豸亥喧繧ｿ繧ｹ繧ｯ = **蜍吶Γ (Tsutome)**  
  - 鄙呈・繧ｿ繧ｹ繧ｯ = **菫ｮ邱ｴ (Shuren)**  
  - 髟ｷ譛溽岼讓・= **蟶ｫ遽・(Shihan)**  
  - 遯∫匱繧ｿ繧ｹ繧ｯ = **蛻ｺ螳｢ (Shikaku)**  
  - 繝懊せ謌ｦ繝ｻ繧ｹ繝医・繝ｪ繝ｼ騾ｲ陦後・陬・ｙ蜿朱寔繝ｻ鬲疲ｳ・繧ｹ繧ｭ繝ｫ縺ｪ縺ｩ繧堤ｵ・∩蜷医ｏ縺帙∵律蟶ｸ繧ｿ繧ｹ繧ｯ繧偵ご繝ｼ繝騾ｲ陦後↓螟画鋤縺吶ｋ縲・- **菴灘鴨/邨碁ｨ灘､/謇謖・≡/邏譚・* 繧貞・騾壹Μ繧ｽ繝ｼ繧ｹ縺ｨ縺励√ち繧ｹ繧ｯ螳御ｺ・ｄ譛滄剞驕・ｻｶ縺ｧ繝励Ξ繧､繝､繝ｼ迥ｶ諷九′荳贋ｸ九☆繧九・- **AI豢ｻ逕ｨ**: 蜍吶Γ繝ｻ菫ｮ邱ｴ繝ｻ蟶ｫ遽・・蛻ｺ螳｢繝ｻ繝懊せ縺ｪ縺ｩ縺ｮ蜷咲ｧｰ/繧､繝ｩ繧ｹ繝・隱ｬ譏取枚繧・OpenAI API 縺ｧ閾ｪ蜍慕函謌撰ｼ・allback 縺ゅｊ・峨・
---

## 2. 繧ｳ繧｢繝ｫ繝ｼ繝励→莉墓ｧ伜ｮ溯｣・憾豕・| 鬆・岼 | 險ｭ險郁ｦ∽ｻｶ | 螳溯｣・憾豕・(2025/11/23) | 蛯呵・|
| --- | --- | --- | --- |
| 蜍吶Γ (Tsutome) | 1蟷ｴ莉･蜀・悄髯舌・屮譏灘ｺｦ繝ｻ繧ｸ繝｣繝ｳ繝ｫ繝ｻ菫ｮ邱ｴ/蟶ｫ遽・ｴ蝉ｻ倥￠縲∵掠譛溷ｮ御ｺ・・繝ｼ繝翫せ縲・≦蟒ｶ繝繝｡繝ｼ繧ｸ/謨ｵ蠑ｷ蛹悶√く繝｣繝ｳ繧ｻ繝ｫ繝壹リ繝ｫ繝・ぅ | 笨・譛滄剞繝舌Μ繝・・繧ｷ繝ｧ繝ｳ/譌ｩ譛溘・繝ｼ繝翫せ/繧ｭ繝｣繝ｳ繧ｻ繝ｫ繝壹リ繝ｫ繝・ぅ(HP-20, Coins-100, EXP-50) 繧貞ｮ溯｣・・br>笞 謨ｵ蠑ｷ蛹悶・DEX蝗樣∩繝ｻ邏譚先ｲ｡蜿弱↑縺ｩ縺ｯ譛ｪ謳ｭ霈峨・| Cron: 譛滓律雜・∴縺ｧ10HP/譌･縲∵雰蠑ｷ蛹悶Ο繧ｸ繝・け縺ｯTODO縲・|
| 菫ｮ邱ｴ (Shuren) | 30譌･莉･蜀・ｹｰ繧願ｿ斐＠縲√し繝懊ｊ5蝗槭〒繧ｳ繧ｹ繝亥ｾｴ蜿・蜑企勁縲∝漁繝｡繝懊・繝翫せ | 笨・郢ｰ繧願ｿ斐＠髢馴囈蛻ｶ髯舌→5蝗槭し繝懊ｊ縺ｧ繧ｳ繧､繝ｳ/EXP貂帷ｮ冷・蜑企勁繧貞ｮ溯｣・・br>笞 騾｣邯壽律謨ｰ繝懊・繝翫せ隧ｳ邏ｰ/UI蜿肴丐縺ｯ莉雁ｾ後・| |
| 蟶ｫ遽・(Shihan) | 髟ｷ譛溽岼讓吶∝漁繝｡邏蝉ｻ倥￠縺ｧ蝣ｱ驟ｬ蠅怜刈縲√い繧､繝・Β驟榊ｸ・| 笨・蝓ｺ譛ｬ邏蝉ｻ倥￠/蝣ｱ驟ｬ +20% 繝懊・繝翫せ縲・br>笞 繧｢繧､繝・Β驟榊ｸ・・蜈崎ｨｱ逧・ｼ晄ｼ泌・縺ｯ譛ｪ螳溯｣・・| |
| 蛻ｺ螳｢ (Shikaku) | 遯∫匱霑ｽ蜉繝ｻ24h縺ｧ閾ｪ蜍墓ｶ域ｻ・・繝繝｡繝ｼ繧ｸ | 笨・Cron縺ｧ譌･谺｡逕滓・/譛滄剞蛻・ｌ繝繝｡繝ｼ繧ｸ・・0HP・峨∵焔蜍穂ｽ懈・繧・4h譛滄剞縲・| |
| 繝懊せ謌ｦ | 譌･谺｡繝励Ξ繧､繝､繝ｼ謾ｻ謦・・繝懊せ蜿肴茶縲・譌･蠕後↓騾ｱ谺｡繝溘ル繧ｿ繧ｹ繧ｯ縲∬｣・ｙ陬懈ｭ｣ | 笨・謇句虚謾ｻ謦・ｼ・ron閾ｪ蜍墓判謦・↓陬・ｙ繝懊・繝翫せ繧貞渚譏貂医∩縲・br>7譌･邨碁℃蠕後↓縲後・繧ｹ縺ｮ隧ｦ邱ｴ縲・蛻ｺ螳｢謇ｱ縺・ 繧・莉ｶ縺縺醍函謌舌・br>笞 髮｣譏灘ｺｦ閾ｪ蜍戊ｪｿ謨ｴ繝ｻ鬲疲ｳ・繧ｹ繧ｭ繝ｫ譛ｪ螳溯｣・・| |
| 陬・ｙ/邏譚・繝峨Ο繝・・ | 豁ｦ蝎ｨ/髦ｲ蜈ｷ/繧｢繧ｯ繧ｻ遞ｮ蛻･縲《tatBoost縲√ラ繝ｭ繝・・螻･豁ｴ | 笨・itemType 豁｣隕丞喧繝ｻrarity/dropRate 繧奪B/繝｡繝｢繝ｪ荳｡譁ｹ縺ｧ菫晄戟縲り｣・ｙ繝懊・繝翫せ繧呈姶髣倥ム繝｡繝ｼ繧ｸ險育ｮ励∈蜿肴丐縲・br>笞 邏譚絶・骰帛・繝ｬ繧ｷ繝斐ｄ繧ｹ繝・険繧翫・譛ｪ蟆主・縲・| |
| 繧ｹ繝医Ξ繝ｼ繧ｸ | MemStorage 縺ｨ PostgreSQL縲・B逕ｨ縺ｫ drop_history / rarity / aiStrictness 縺ｪ縺ｩ繧貞｢苓ｨｭ縲・| 笨・DB謗･邯壹Δ繝ｼ繝・(pg) 縺ｧ譛ｬ逡ｪ遞ｼ蜒阪Ａmigrations/0001_gameplay_extensions.sql` 繧帝←逕ｨ貂医∩縲・| |

---

## 3. 謚陦薙せ繧ｿ繝・け
- **繝輔Ο繝ｳ繝・*: React + Vite + TypeScript + Tailwind CSS + Radix UI + react-hook-form
- **繧ｵ繝ｼ繝舌・**: Node.js / Express / zod / cron / pg
- **DB**: PostgreSQL 16
- **繧､繝ｳ繝輔Λ**: Ubuntu 22.04 + PM2 + nginx + Let窶冱 Encrypt

---

## 4. 繝・・繝ｭ繧､ / 繝ｩ繝ｳ繧ｿ繧､繝諠・ｱ
| 鬆・岼 | 蜀・ｮｹ |
| --- | --- |
| 繧ｵ繝ｼ繝舌・ | `ubuntu@153.121.72.94` (tsutomeapp.com) |
| 繝ｫ繝ｼ繝・| `/opt/tsutomeapp` |
| 螳溯｡後Θ繝ｼ繧ｶ繝ｼ | ubuntu |
| 繝昴・繝域ｧ区・ | nginx:80/443 竊・Node:4000 |
| 蟶ｸ鬧千ｮ｡逅・| `pm2`・・ecosystem.config.cjs`・・|
| 荳ｻ隕√さ繝槭Φ繝・| `npm ci`, `npm run build`, `pm2 restart tsutomeapp --update-env`, `pm2 logs tsutomeapp` |
| Cron | 繧｢繝励Μ蜀・node-cron: 譌･谺｡繝ｪ繧ｻ繝・ヨ(JST0:00)縲∵ｯ取凾繝√ぉ繝・け |

### 4.1 迺ｰ蠅・､画焚
`/opt/tsutomeapp/.env` 縺翫ｈ縺ｳ `ecosystem.config.cjs`
```
PORT=4000
NODE_ENV=production
DATABASE_URL=postgresql://tsutome:tsutomepass@localhost:5433/tsutomeapp
OPENAI_API_KEY=YOUR_OPENAI_API_KEY
```
> API繧ｭ繝ｼ縺ｯ遘伜諺蠢・医ょ､画峩蠕後・ `pm2 restart tsutomeapp --update-env`縲・
### 4.2 繝・・繝ｭ繧､謇矩・```
ssh -i ~/.ssh/tsutomeapp ubuntu@153.121.72.94
cd /opt/tsutomeapp
git pull origin main
npm ci
npm run build
pm2 restart tsutomeapp --update-env
pm2 save
```
DB繝槭う繧ｰ繝ｬ繝ｼ繧ｷ繝ｧ繝ｳ:
```
psql "$DATABASE_URL" -f migrations/0001_gameplay_extensions.sql
# or drizzle-kit 遲峨〒 push
```
蛻晄悄繝・・繧ｿ謚募・:
```
export $(cat .env | xargs)
npx tsx scripts/seed-db.ts
```

---

## 5. SSH / 繧､繝ｳ繝輔Λ諠・ｱ
| 鬆・岼 | 蜀・ｮｹ |
| --- | --- |
| 繝ｭ繝ｼ繧ｫ繝ｫ遘伜ｯ・嵯 | `C:\\Users\\dokog\\.ssh\\tsutomeapp`・・assphrase 縺ｯ逕滓・譎りｨｭ螳壹らｴ帛､ｱ豕ｨ諢擾ｼ・|
| 蜈ｬ髢矩嵯險ｭ鄂ｮ | `/home/ubuntu/.ssh/authorized_keys` |
| 謗･邯壻ｾ・| `ssh -i ~/.ssh/tsutomeapp ubuntu@153.121.72.94` |
| SSH config 萓・| `Host tsutomeapp` / `HostName 153.121.72.94` / `User ubuntu` / `IdentityFile ~/.ssh/tsutomeapp` |
| 繝代せ繝ｯ繝ｼ繝芽ｪ崎ｨｼ | 縺ｾ縺譛牙柑縲る嵯謗･邯夂｢ｺ隱榊ｾ・`PasswordAuthentication no` 縺ｸ蛻・崛謗ｨ螂ｨ縲・|
| nginx | `/etc/nginx/sites-available/tsutomeapp` 竊・`sites-enabled` 縺ｫ symlink縲・|
| TLS | `certbot --nginx -d tsutomeapp.com --redirect` 縺ｧ蜿門ｾ玲ｸ医・|
| PM2 | `pm2 status`, `pm2 logs tsutomeapp`, `pm2 update`, `pm2 save` |

---

## 6. 譛霑代・螟画峩轤ｹ
1. OpenAI API 繧ｭ繝ｼ繧呈悽逡ｪ迺ｰ蠅・↓險ｭ螳壹＠縲、I逕滓・讖溯・繧呈怏蜉ｹ蛹悶・2. 譌ｧDocker繧ｹ繧ｿ繝・け・・addy/web/worker/api/db/redis・峨ｒ蛛懈ｭ｢繝ｻ蜑企勁縺励√・繝ｼ繝育ｫｶ蜷医ｒ隗｣豸医・3. DB繝峨Λ繧､繝舌ｒ `@neondatabase/serverless` 竊・`pg` 縺ｫ蛻・ｊ譖ｿ縺医∝ｮ牙ｮ壼喧縲・4. `migrations/0001_gameplay_extensions.sql` 縺ｧ players/items/drop_history 繧呈僑蠑ｵ縲・5. 繧ｭ繝｣繝ｳ繧ｻ繝ｫ繝壹リ繝ｫ繝・ぅ縲∬｣・ｙ繝懊・繝翫せ蜿肴丐縲√・繧ｹ騾ｱ谺｡繝溘ル繧ｿ繧ｹ繧ｯ縲∽ｿｮ邱ｴ繝壹リ繝ｫ繝・ぅ遲峨ｒ霑ｽ蜉縲・
---

## 7. 譌｢遏･縺ｮ隱ｲ鬘・/ TODO
- 蜍吶Γ謨ｵ蠑ｷ蛹・DEX蝗樣∩縲∫ｴ譚先ｲ｡蜿弱・ｭ疲ｳ輔・繧ｹ繧ｭ繝ｫ縲・惚蜀ｶ繝ｬ繧ｷ繝斐↑縺ｩ險育判隕∫ｴ縺梧悴螳溯｣・・- 菫ｮ邱ｴ縺ｮ騾｣邯壹・繝ｼ繝翫せ/蟶ｫ遽・°繧峨・邏譚宣・蟶・UI 縺梧悴謨ｴ蛯吶・- Cron繝ｭ繧ｸ繝・け縺ｮ繝・せ繝医′荳崎ｶｳ縲・I縺ｧ `npm run check` 莉･螟悶・閾ｪ蜍輔ユ繧ｹ繝医′譛ｪ蟆主・縲・- SSH 繝代せ繝ｯ繝ｼ繝芽ｪ崎ｨｼ縺梧怏蜉ｹ縲・ail2ban遲峨・霑ｽ蜉髦ｲ蠕｡繧よ悴蟆主・縲・- 逶｣隕厄ｼ・ptime/繧｢繝励Μ繝倥Ν繧ｹ・峨→DB繝舌ャ繧ｯ繧｢繝・・菴灘宛縺梧悴謨ｴ蛯吶・
---

## 8. 谺｡縺ｫ繧・ｋ縺ｨ濶ｯ縺・％縺ｨ
1. **繧ｻ繧ｭ繝･繝ｪ繝・ぅ蠑ｷ蛹・*: SSH繝代せ繝ｯ繝ｼ繝牙●豁｢縲～pm2 update`, Fail2ban蟆主・縲∬ｨｼ霍｡繝ｭ繧ｰ縺ｮ謨ｴ蛯吶・2. **繧ｲ繝ｼ繝繝ｭ繧ｸ繝・け諡｡蠑ｵ**: 蜍吶Γ縺ｮ謨ｵ蠑ｷ蛹・DEX蝗樣∩縲∽ｿｮ邱ｴ繝ｻ蟶ｫ遽・・繝ｼ繝翫せ縺ｮ隧ｳ邏ｰ繝ｭ繧ｸ繝・け縲√い繧､繝・Β/骰帛・/鬲疲ｳ輔す繧ｹ繝・Β縲・3. **UX蜷台ｸ・*: 繧ｭ繝｣繝ｳ繧ｻ繝ｫ隴ｦ蜻翫ｄ繝懊せ謾ｻ謦・Ο繧ｰ繧旦I縺ｫ蜿ｯ隕門喧縲√Α繝九ち繧ｹ繧ｯ騾夂衍縲∵圜繝ｻ繧｢繝ｼ繧ｫ繧､繝也判髱｢縲・4. **繝・せ繝茨ｼ・I**: Cron繝ｻ繧ｭ繝｣繝ｳ繧ｻ繝ｫ繝ｻ繝懊せ謌ｦ縺ｮ繝ｦ繝ｼ繧ｹ繧ｱ繝ｼ繧ｹ繝・せ繝医；itHub Actions 遲峨〒閾ｪ蜍募喧縲・5. **逶｣隕悶→繝舌ャ繧ｯ繧｢繝・・**: Uptime逶｣隕悶｝g_dump 縺ｫ繧医ｋ螳壽悄繝舌ャ繧ｯ繧｢繝・・縲√Ο繧ｰ繝ｭ繝ｼ繝・繧｢繝ｩ繝ｼ繝郁ｨｭ螳壹・
---

縺薙・繝峨く繝･繝｡繝ｳ繝医・ `docs/app-overview.md` 縺ｫ菫晏ｭ俶ｸ医∩縺ｧ縺吶・

### 9. 譛譁ｰ繧｢繝・・繝・・繝・(2025-11-24)
- 蜍吶Γ縺ｮ謨ｵ繝｢繝ｳ繧ｹ繧ｿ繝ｼ縺ｫ縲悟ｼｷ蛹悶Ξ繝吶Ν縲阪ｒ蟆主・縺励・幕蟋区律縺九ｉ縺ｮ邨碁℃譌･謨ｰ縺ｨ譛滄剞雜・℃譌･謨ｰ縺ｧ豈取律蠑ｷ蛹悶ょｼｷ蛹悶Ξ繝吶Ν縺ｯHP繝壹リ繝ｫ繝・ぅ險育ｮ励→騾｣蜍輔・- 驕・ｻｶ繝繝｡繝ｼ繧ｸ蜃ｦ逅・〒繝励Ξ繧､繝､繝ｼ縺ｮ謨乗差(DEX)+陬・ｙ陬懈ｭ｣繧貞盾辣ｧ縺励∵判謦・ｒ遒ｺ邇・〒蝗樣∩縺ｧ縺阪ｋDEX繝ｭ繝ｼ繝ｫ繧定ｿｽ蜉縲ゅΟ繧ｰ縺ｫ縺ｯ蝗樣∩蝗樊焚繧定ｨ倬鹸縲・- 菫ｮ邱ｴ繝懊・繝翫せ繧偵悟渕譛ｬ5% + 騾｣邯壽律謨ｰ繝懊・繝翫せ + 騾夂ｮ玲律謨ｰ繝懊・繝翫せ縲阪↓蜀崎ｨｭ險茨ｼ域怙螟ｧ50%・峨ょｸｫ遽・・繝ｼ繝翫せ繧るｲ謐礼紫/譛滓律縺ｾ縺ｧ縺ｮ譌･謨ｰ縺ｧ繧ｹ繧ｱ繝ｼ繝ｫ・域怙螟ｧ45%・峨・- API繝ｬ繧ｹ繝昴Φ繧ｹ縺ｮ `linkSource` 縺ｫ breakdown 繧・ｶ咏ｶ壽律謨ｰ縺ｪ縺ｩ縺ｮ隧ｳ邏ｰ繧剃ｻ倅ｸ弱＠縲ゞI縺ｧ繧らｶ咏ｶ・騾ｲ謐玲ュ蝣ｱ繧定｡ｨ遉ｺ縲・
